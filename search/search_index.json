{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Pr\u00e1ctica 2.2 Creaci\u00f3n de usuarios y contrase\u00f1as para el acceso Verificamos que tenemos openssl en la m\u00e1quina: Creamos un archivo para guardar usuarios y contrase\u00f1as llamado \".htpasswd\" ejecutando: sudo sh -c \"echo -n 'alberto:' >> /etc/nginx/.htpasswd\" y tambi\u00e9n crearemos una contrase\u00f1a cifrada ejecutando: sudo sh -c \"openssl passwd -apr1 >> /etc/nginx/.htpasswd Voy a crear dos usuarios distintos y a leer el fichero para comprobar que el contenido es correcto: Configuraci\u00f3n para autenticaci\u00f3n b\u00e1sica Para configurar la autentificaci\u00f3n de nuestro servidor, modificaremos el archivo /etc/nginx/sites-available/despliegue1 y a\u00f1adiremos dos nuevas l\u00edneas dentro del apartado \"location\": Reiniciamos el servicio y comprobamos que no hay ning\u00fan error con: sudo systemctl restart nginx sudo nginx -t Ahora, si tratamos de entrar a la p\u00e1gina desde el navegador, aparecer\u00e1 el siguiente mensaje: Si nos autentificamos correctamente, entraremos a la p\u00e1gina sin problema. En caso de que no indiquemos uno de los usuarios y contrase\u00f1a que hemos creado anteriormente, no se nos permitir\u00e1 el acceso a la p\u00e1gina: Podemos comprobar los registros de peticiones de entrada a la p\u00e1gina en /var/log/nginx/access.log y /var/log/nginx/error.log (peticiones denegadas o err\u00f3neas): Restricci\u00f3n de acceso por IP A continuaci\u00f3n, vamos a configurar una restricci\u00f3n de acceso para que s\u00f3lo tengan acceso las IPs que indiquemos. Para ello, volvemos a editar el archivo /etc/nginx/sites-available/despliegue1: Desglosando las l\u00edneas a\u00f1adidas: La configuraci\u00f3n \"satisfy all\" obliga a que cada direcci\u00f3n IP deba cumplir tanto la autentificaci\u00f3n que configuramos anteriormente como que la solicitud provenga de una IP v\u00e1lida. Si en su lugar indic\u00e1semos \"satisfy any\", valdr\u00eda con que s\u00f3lo se cumpliera una de las dos condiciones. Las l\u00edneas \"deny 192.168.X.X\" restringen el acceso de esas direcciones de manera espec\u00edfica. Como est\u00e1 activado \"satisfy all\", no se podr\u00e1 acceder ni aunque se conozca un usuario y contrase\u00f1a v\u00e1lidos. En este caso, he prohibido las direcciones IP que en mi red local se refieren a mi m\u00e1quina f\u00edsica. La l\u00ednea \"allow 192.168.X.X\" permite el acceso de una IP en espec\u00edfico, aunque ser\u00e1 necesario autentificarse para acceder a la p\u00e1gina. En este caso, he permitido el acceso de la m\u00e1quina virtual en la que se aloja el servidor. La l\u00ednea \"deny all\" indica que el resto de direcciones desde las que se solicite acceso tienen entrada prohibida a la p\u00e1gina. Debe colocarse al final para que sea evaluada en \u00faltimo lugar y no proh\u00edba el acceso de IPs que s\u00ed queremos que tengan acceso. Tras guardar los cambios con la nueva configuraci\u00f3n, compruebo desde mi m\u00e1quina f\u00edsica que al intentar entrar a la p\u00e1gina, se me proh\u00edbe el acceso: Y tambi\u00e9n se puede comprobar que efectivamente se ha prohibido el acceso a esta IP desde el archivo /var/log/nginx/error.log: Cuestiones finales Cuesti\u00f3n 1 Supongamos que yo soy el cliente con la IP 172.1.10.15 e intento acceder al directorio \"web_muy_guay\" de mi sitio web, equivoc\u00e1ndome al poner el usuario y contrase\u00f1a. \u00bfPodr\u00e9 acceder?\u00bfPor qu\u00e9? location /web_muy_guay { #... satisfy all; deny 172.1.10.6; allow 172.1.10.15; allow 172.1.3.14; deny all; auth_basic \"Cuesti\u00f3n final 1\"; auth_basic_user_file conf/htpasswd; } Por la directiva \"satisfy all\", el usuario tendr\u00e1 que cumplir con todas las reglas de acceso; por una parte, lo tiene permitido por la directiva \"allow 172.1.10.15\", pero tambi\u00e9n est\u00e1 obligado a autenticarse seg\u00fan los credenciales almacenados en \"conf/htpasswd\". Cuesti\u00f3n 2 Supongamos que yo soy el cliente con la IP 172.1.10.15 e intento acceder al directorio web_muy_guay de mi sitio web, introduciendo correctamente usuari y contrase\u00f1a. \u00bfPodr\u00e9 acceder?\u00bfPor qu\u00e9? location /web_muy_guay { #... satisfy all; deny all; deny 172.1.10.6; allow 172.1.10.15; allow 172.1.3.14; auth_basic \"Cuesti\u00f3n final 2: The revenge\"; auth_basic_user_file conf/htpasswd; } En este caso, el usuario tampoco podr\u00e1 acceder, ya que como la directiva \"deny all\" se eval\u00faa antes que \"allow 172.1.10.15\" y que la directiva de autenticaci\u00f3n, el servidor le denegar\u00e1 el acceso. Cuesti\u00f3n 3 Supongamos que yo soy el cliente con la IP 172.1.10.15 e intento acceder al directorio web_muy_guay de mi sitio web, introduciendo correctamente usuario y contrase\u00f1a. \u00bfPodr\u00e9 acceder?\u00bfPor qu\u00e9? location /web_muy_guay { #... satisfy any; deny 172.1.10.6; deny 172.1.10.15; allow 172.1.3.14; auth_basic \"Cuesti\u00f3n final 3: The final combat\"; auth_basic_user_file conf/htpasswd; } Tampoco le ser\u00e1 posible al usuario acceder, ya que se le est\u00e1 denegando el acceso expl\u00edcitamente a su IP con la directiva \"deny 172.1.10.15\". Cuesti\u00f3n 4 Supongamos que quiero restringir el acceso al directorio de proyectos porque es muy secreto, eso quiere decir a\u00f1adir autenticaci\u00f3n b\u00e1sica a la URL:Proyectos. Completa la configuraci\u00f3n para conseguirlo: server { listen 80; listen [::]:80; root /var/www/freewebsitetemplates.com/preview/space-science; index index.html index.htm index.nginx-debian.html; server_name freewebsitetemplates.com www.freewebsitetemplates.com; location { try_files $uri $uri/ =404; } location /proyectos { auth_basic \"Cuesti\u00f3n final 3: The final combat\"; auth_basic_user_file conf/htpasswd; try_files $uri $uri/ =404; } }","title":"Pr\u00e1ctica 2.2"},{"location":"#practica-22","text":"","title":"Pr\u00e1ctica 2.2"},{"location":"#creacion-de-usuarios-y-contrasenas-para-el-acceso","text":"Verificamos que tenemos openssl en la m\u00e1quina: Creamos un archivo para guardar usuarios y contrase\u00f1as llamado \".htpasswd\" ejecutando: sudo sh -c \"echo -n 'alberto:' >> /etc/nginx/.htpasswd\" y tambi\u00e9n crearemos una contrase\u00f1a cifrada ejecutando: sudo sh -c \"openssl passwd -apr1 >> /etc/nginx/.htpasswd Voy a crear dos usuarios distintos y a leer el fichero para comprobar que el contenido es correcto:","title":"Creaci\u00f3n de usuarios y contrase\u00f1as para el acceso"},{"location":"#configuracion-para-autenticacion-basica","text":"Para configurar la autentificaci\u00f3n de nuestro servidor, modificaremos el archivo /etc/nginx/sites-available/despliegue1 y a\u00f1adiremos dos nuevas l\u00edneas dentro del apartado \"location\": Reiniciamos el servicio y comprobamos que no hay ning\u00fan error con: sudo systemctl restart nginx sudo nginx -t Ahora, si tratamos de entrar a la p\u00e1gina desde el navegador, aparecer\u00e1 el siguiente mensaje: Si nos autentificamos correctamente, entraremos a la p\u00e1gina sin problema. En caso de que no indiquemos uno de los usuarios y contrase\u00f1a que hemos creado anteriormente, no se nos permitir\u00e1 el acceso a la p\u00e1gina: Podemos comprobar los registros de peticiones de entrada a la p\u00e1gina en /var/log/nginx/access.log y /var/log/nginx/error.log (peticiones denegadas o err\u00f3neas):","title":"Configuraci\u00f3n para autenticaci\u00f3n b\u00e1sica"},{"location":"#restriccion-de-acceso-por-ip","text":"A continuaci\u00f3n, vamos a configurar una restricci\u00f3n de acceso para que s\u00f3lo tengan acceso las IPs que indiquemos. Para ello, volvemos a editar el archivo /etc/nginx/sites-available/despliegue1: Desglosando las l\u00edneas a\u00f1adidas: La configuraci\u00f3n \"satisfy all\" obliga a que cada direcci\u00f3n IP deba cumplir tanto la autentificaci\u00f3n que configuramos anteriormente como que la solicitud provenga de una IP v\u00e1lida. Si en su lugar indic\u00e1semos \"satisfy any\", valdr\u00eda con que s\u00f3lo se cumpliera una de las dos condiciones. Las l\u00edneas \"deny 192.168.X.X\" restringen el acceso de esas direcciones de manera espec\u00edfica. Como est\u00e1 activado \"satisfy all\", no se podr\u00e1 acceder ni aunque se conozca un usuario y contrase\u00f1a v\u00e1lidos. En este caso, he prohibido las direcciones IP que en mi red local se refieren a mi m\u00e1quina f\u00edsica. La l\u00ednea \"allow 192.168.X.X\" permite el acceso de una IP en espec\u00edfico, aunque ser\u00e1 necesario autentificarse para acceder a la p\u00e1gina. En este caso, he permitido el acceso de la m\u00e1quina virtual en la que se aloja el servidor. La l\u00ednea \"deny all\" indica que el resto de direcciones desde las que se solicite acceso tienen entrada prohibida a la p\u00e1gina. Debe colocarse al final para que sea evaluada en \u00faltimo lugar y no proh\u00edba el acceso de IPs que s\u00ed queremos que tengan acceso. Tras guardar los cambios con la nueva configuraci\u00f3n, compruebo desde mi m\u00e1quina f\u00edsica que al intentar entrar a la p\u00e1gina, se me proh\u00edbe el acceso: Y tambi\u00e9n se puede comprobar que efectivamente se ha prohibido el acceso a esta IP desde el archivo /var/log/nginx/error.log:","title":"Restricci\u00f3n de acceso por IP"},{"location":"#cuestiones-finales","text":"","title":"Cuestiones finales"},{"location":"#cuestion-1","text":"Supongamos que yo soy el cliente con la IP 172.1.10.15 e intento acceder al directorio \"web_muy_guay\" de mi sitio web, equivoc\u00e1ndome al poner el usuario y contrase\u00f1a. \u00bfPodr\u00e9 acceder?\u00bfPor qu\u00e9? location /web_muy_guay { #... satisfy all; deny 172.1.10.6; allow 172.1.10.15; allow 172.1.3.14; deny all; auth_basic \"Cuesti\u00f3n final 1\"; auth_basic_user_file conf/htpasswd; } Por la directiva \"satisfy all\", el usuario tendr\u00e1 que cumplir con todas las reglas de acceso; por una parte, lo tiene permitido por la directiva \"allow 172.1.10.15\", pero tambi\u00e9n est\u00e1 obligado a autenticarse seg\u00fan los credenciales almacenados en \"conf/htpasswd\".","title":"Cuesti\u00f3n 1"},{"location":"#cuestion-2","text":"Supongamos que yo soy el cliente con la IP 172.1.10.15 e intento acceder al directorio web_muy_guay de mi sitio web, introduciendo correctamente usuari y contrase\u00f1a. \u00bfPodr\u00e9 acceder?\u00bfPor qu\u00e9? location /web_muy_guay { #... satisfy all; deny all; deny 172.1.10.6; allow 172.1.10.15; allow 172.1.3.14; auth_basic \"Cuesti\u00f3n final 2: The revenge\"; auth_basic_user_file conf/htpasswd; } En este caso, el usuario tampoco podr\u00e1 acceder, ya que como la directiva \"deny all\" se eval\u00faa antes que \"allow 172.1.10.15\" y que la directiva de autenticaci\u00f3n, el servidor le denegar\u00e1 el acceso.","title":"Cuesti\u00f3n 2"},{"location":"#cuestion-3","text":"Supongamos que yo soy el cliente con la IP 172.1.10.15 e intento acceder al directorio web_muy_guay de mi sitio web, introduciendo correctamente usuario y contrase\u00f1a. \u00bfPodr\u00e9 acceder?\u00bfPor qu\u00e9? location /web_muy_guay { #... satisfy any; deny 172.1.10.6; deny 172.1.10.15; allow 172.1.3.14; auth_basic \"Cuesti\u00f3n final 3: The final combat\"; auth_basic_user_file conf/htpasswd; } Tampoco le ser\u00e1 posible al usuario acceder, ya que se le est\u00e1 denegando el acceso expl\u00edcitamente a su IP con la directiva \"deny 172.1.10.15\".","title":"Cuesti\u00f3n 3"},{"location":"#cuestion-4","text":"Supongamos que quiero restringir el acceso al directorio de proyectos porque es muy secreto, eso quiere decir a\u00f1adir autenticaci\u00f3n b\u00e1sica a la URL:Proyectos. Completa la configuraci\u00f3n para conseguirlo: server { listen 80; listen [::]:80; root /var/www/freewebsitetemplates.com/preview/space-science; index index.html index.htm index.nginx-debian.html; server_name freewebsitetemplates.com www.freewebsitetemplates.com; location { try_files $uri $uri/ =404; } location /proyectos { auth_basic \"Cuesti\u00f3n final 3: The final combat\"; auth_basic_user_file conf/htpasswd; try_files $uri $uri/ =404; } }","title":"Cuesti\u00f3n 4"}]}